# Docker Compose configuration for SQLite database instance: {{ instance_name }}
version: '3.8'

services:
  sqlite:
    image: nouchka/sqlite3:latest
    container_name: {{ instance_name }}_sqlite
    restart: unless-stopped
    volumes:
      - {{ data_dir }}/sqlite:/db
      - ./bootstrap:/docker-entrypoint-initdb.d
    working_dir: /db
    command: tail -f /dev/null  # Keep container running
    healthcheck:
      test: ["CMD", "ls", "/db/{{ instance_name }}.db"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  sqlite-browser:
    image: linuxserver/sqlitebrowser:latest
    container_name: {{ instance_name }}_sqlite_browser
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Munich
    volumes:
      - {{ data_dir }}/sqlite:/db
      - {{ data_dir }}/config:/config
    ports:
      - "{{ admin_port }}:3000"
    depends_on:
      sqlite:
        condition: service_healthy

  sqlite-web:
    image: coleifer/sqlite-web
    container_name: {{ instance_name }}_sqlite_web
    restart: unless-stopped
    volumes:
      - {{ data_dir }}/sqlite:/data
    ports:
      - "{{ db_port }}:8080"
    command: ["sqlite_web", "/data/{{ instance_name }}.db", "--host", "0.0.0.0", "--port", "8080"]
    depends_on:
      sqlite:
        condition: service_healthy

networks:
  default:
    name: {{ instance_name }}_network