-- =============================================================================
-- Bootstrap script for PostgreSQL instance: {{ instance_name }}
-- Creates additional databases and sets up basic configuration
-- =============================================================================

-- Ensure we're connected to the main database
\c {{ instance_name }};

-- Create extensions that are commonly used
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pg_stat_statements";

-- Grant all privileges to postgres user
GRANT ALL PRIVILEGES ON DATABASE {{ instance_name }} TO postgres;

-- Set up basic configuration
ALTER DATABASE {{ instance_name }} SET timezone TO 'UTC';
ALTER DATABASE {{ instance_name }} SET log_statement TO 'all';

-- Create a demo table for testing
CREATE TABLE IF NOT EXISTS demo_connection_test (
    id SERIAL PRIMARY KEY,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    test_data TEXT DEFAULT 'Instance {{ instance_name }} is ready'
);

-- Insert test data
INSERT INTO demo_connection_test (test_data) VALUES ('Bootstrap completed successfully');

-- Log completion
DO $$
BEGIN
    RAISE NOTICE 'Bootstrap completed for instance: {{ instance_name }}';
END
$$;